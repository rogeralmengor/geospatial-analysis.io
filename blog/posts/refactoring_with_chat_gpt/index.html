
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lately, there's been a lot of talk about AI stealing our jobs as software developers. However, I prefer to see it as a tool that takes care of the boring stuff, freeing us up to focus on the more exciting aspects of our work. AI can handle tasks like dealing with documentation, fixing code, coming up with test ideas, and explaining code, allowing us to spend more time understanding what users really need and finding creative solutions. So, in today's blog post, I wanted to try something I've been meaning to do for a while. I'll put Chat-GPT to the test...">
      
      
      
        <link rel="canonical" href="https://rogeralmengor.github.io/geospatial-analysis.io/blog/posts/refactoring_with_chat_gpt/">
      
      
        <link rel="prev" href="../nox_levels_in_panama/">
      
      
        <link rel="next" href="../river_dam_el_valle/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.2.0-b3">
    
    
      
        <title>Being kind with my future self, using Chat-GPT to explain my past code. - Roger Almengor González</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.83068744.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-40-176h24v-64h-24c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-80c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M480 32c0-12.9-7.8-24.6-19.8-29.6S434.5.2 425.3 9.3L381.7 53c-48 48-113.1 75-181 75H64c-35.3 0-64 28.7-64 64v96c0 35.3 28.7 64 64 64v128c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V352h8.7c67.9 0 133 27 181 75l43.6 43.6c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V300.4c18.6-8.8 32-32.5 32-60.4s-13.4-51.6-32-60.4V32zm-64 76.7v262.6C357.2 317.8 280.5 288 200.7 288H192v-96h8.7c79.8 0 156.5-29.8 215.3-83.3z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7l233.4-233.3c12.5-12.5 32.8-12.5 45.3 0z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-86.2-346.7c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1 0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6-13.3 0-24-10.7-24-24v-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1 0-8.4-6.8-15.1-15.1-15.1h-58.3c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7.2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8.2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24v112c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0-64 0 32 32 0 1 0 64 0z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.1 52.4 442.6 6.5c-1.9-3.9-6.1-6.5-10.5-6.5s-8.5 2.6-10.4 6.5l-16.5 45.9-46 16.8c-4.3 1.6-7.3 5.9-7.2 10.4 0 4.5 3 8.7 7.2 10.2l45.7 16.8 16.8 45.8c1.5 4.4 5.8 7.5 10.4 7.5s8.9-3.1 10.4-7.5l16.5-45.8 45.7-16.8c4.2-1.5 7.2-5.7 7.2-10.2 0-4.6-3-8.9-7.2-10.4l-45.6-16.8zm-132.4 53c-12.5-12.5-32.8-12.5-45.3 0l-2.9 2.9c-22-8-45.8-12.3-70.5-12.3C93.1 96 0 189.1 0 304s93.1 208 208 208 208-93.1 208-208c0-24.7-4.3-48.5-12.2-70.5l2.9-2.9c12.5-12.5 12.5-32.8 0-45.3l-80-80zM200 192c-57.4 0-104 46.6-104 104v8c0 8.8-7.2 16-16 16s-16-7.2-16-16v-8c0-75.1 60.9-136 136-136h8c8.8 0 16 7.2 16 16s-7.2 16-16 16h-8z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 398.9c58.5-41.1 96-104.1 96-174.9C512 100.3 397.4 0 256 0S0 100.3 0 224c0 70.7 37.5 133.8 96 174.9V464c0 26.5 21.5 48 48 48h48v-48c0-8.8 7.2-16 16-16s16 7.2 16 16v48h64v-48c0-8.8 7.2-16 16-16s16 7.2 16 16v48h48c26.5 0 48-21.5 48-48v-65.1zM96 256a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm256-64a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M320 0c17.7 0 32 14.3 32 32v64h120c39.8 0 72 32.2 72 72v272c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72h120V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zM264 256a40 40 0 1 0-80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224h16v192H48c-26.5 0-48-21.5-48-48v-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48h-16V224h16z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M288 0H128c-17.7 0-32 14.3-32 32s14.3 32 32 32v132.8c0 11.8-3.3 23.5-9.5 33.5L10.3 406.2C3.6 417.2 0 429.7 0 442.6 0 480.9 31.1 512 69.4 512h309.2c38.3 0 69.4-31.1 69.4-69.4 0-12.8-3.6-25.4-10.3-36.4L329.5 230.4c-6.2-10.1-9.5-21.7-9.5-33.5V64c17.7 0 32-14.3 32-32S337.7 0 320 0h-32zm-96 196.8V64h64v132.8c0 23.7 6.6 46.9 19 67.1l34.5 56.1h-171l34.5-56.1c12.4-20.2 19-43.4 19-67.1z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64V216z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Montserrat";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#first-code-snippets-i-was-creating-test-raster-files" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Roger Almengor González" class="md-header__button md-logo" aria-label="Roger Almengor González" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Roger Almengor González
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Being kind with my future self, using Chat-GPT to explain my past code.
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Roger Almengor González" class="md-nav__button md-logo" aria-label="Roger Almengor González" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Roger Almengor González
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../download_brandenburg_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A database worth downloading for time series analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../functional_programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stop Wasting Time on Intermediate Variables, function composition to the rescue!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../julia_vs_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance benchmarking for Julia and Python in a geospatial task.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nox_levels_in_panama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring Nitrogen Oxide Levels during the COVID 19 Lock-down, Panama City
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Being kind with my future self, using Chat-GPT to explain my past code.
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Being kind with my future self, using Chat-GPT to explain my past code.
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#first-code-snippets-i-was-creating-test-raster-files" class="md-nav__link">
    First code snippets: I was creating test raster files.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-the-code" class="md-nav__link">
    Improving the code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-code" class="md-nav__link">
    Test Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring-the-test-class" class="md-nav__link">
    Refactoring the test class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-if-pytest" class="md-nav__link">
    What if pytest?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../river_dam_el_valle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Landscape changes, my childhood, and the impact of man-made infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../statistics_with_SQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic descriptive statistics using SQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Geospatial analysis toolbox
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Geospatial analysis toolbox
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../geospatial-analysis-toolbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Languages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Languages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../geospatial-analysis-toolbox/Languages/JavaScript%28GEE-API%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaScript(GEE API)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#first-code-snippets-i-was-creating-test-raster-files" class="md-nav__link">
    First code snippets: I was creating test raster files.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-the-code" class="md-nav__link">
    Improving the code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-code" class="md-nav__link">
    Test Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring-the-test-class" class="md-nav__link">
    Refactoring the test class
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-if-pytest" class="md-nav__link">
    What if pytest?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Being kind with my future self, using Chat-GPT to explain my past code.</h1>

<p>Lately, there's been a lot of talk about AI stealing our jobs as software developers. However, I prefer to see it as a tool that takes care of the boring stuff, freeing us up to focus on the more exciting aspects of our work. AI can handle tasks like dealing with documentation, fixing code, coming up with test ideas, and explaining code, allowing us to spend more time understanding what users really need and finding creative solutions. </p>
<p>So, in today's blog post, I wanted to try something I've been meaning to do for a while. I'll put Chat-GPT to the test and use it to explain a code I wrote a couple of years ago. I'll also use some prompts to make the code even better, and improve its overall design and structure. Let's go.</p>
<h3 id="first-code-snippets-i-was-creating-test-raster-files">First code snippets: I was creating test raster files.</h3>
<p>I have in an old repo, the following code. I think I used it to create a very simple raster in GeoTiff format for testing purposes.</p>
<details>
  <summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span> 
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="kn">import</span> <span class="nn">os</span> 
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="c1"># Contants for file creation</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="n">dtype</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="n">driver_name</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="n">geotransform</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000020</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">]</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">x_size</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="n">y_size</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span> <span class="nf">create_value_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a test raster file&quot;&quot;&quot;</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="n">x_size</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span> <span class="n">y_size</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>                            <span class="n">bands</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">x</span> <span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_size</span><span class="p">)]</span>\
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_size</span><span class="p">)])</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span> <span class="nf">create_mask_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span> 
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ysize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>                            <span class="n">bands</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],])</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span> 
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">try</span><span class="p">:</span> 
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> 
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">create_value_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;value_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">create_mask_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;mask_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span> 
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>The code does its work, however there are things that I could improve. Those improvements come from my future self (that happens all the time, I revisit some code I wrote 5 years ago, and I can only cringe).</p>
<p>Now, the time to ask the first question to Chat-GPT has come. In the following snippet you can find the nice question I just asked (I am always polite and try to do it even with advanced language processing systems... who knows maybe they are concious ;o) ):</p>
<p align="center">
      <img src="./../chat_gpt_1_question.png" alt="Centered Image">
      <br>
</p>

<p>And of course... it did it. And the answer is incredibly accurate, detailed and well documented.</p>
<details>
    <summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">import</span> <span class="nn">os</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>This code imports necessary modules from the osgeo package, including gdal for geospatial data processing, osr for spatial reference system operations, and the standard os module for working with the operating system.</p>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">dtype</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">driver_name</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">geotransform</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000020</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">x_size</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="n">y_size</span> <span class="o">=</span> <span class="mi">5</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>Next, some constants are defined:</p>
<ul>
<li>
<p>dtype represents the data type of the raster, set to gdal.GDT_Byte.</p>
</li>
<li>
<p>driver_name specifies the desired driver for creating the raster files, in this case, "GTiff" for GeoTIFF format.</p>
</li>
<li>
<p>geotransform defines the geotransform parameters that describe the position and resolution of the raster data.</p>
</li>
<li>
<p>x_size and y_size indicate the dimensions (width and height) of the raster.</p>
</li>
</ul>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span> <span class="nf">create_value_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a test raster file&quot;&quot;&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="n">x_size</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="n">y_size</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_size</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_size</span><span class="p">)])</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>The create_value_raster function creates a test raster file with a filename provided as an argument. It uses the GDAL driver to create the raster file, setting its dimensions, number of bands, data type, geotransform, and spatial reference information. It then generates an array with increasing values and writes it to the raster band using WriteArray.</p>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">def</span> <span class="nf">create_mask_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a>                      <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a>                      <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a>                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a>                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="err">```</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="o">&lt;/</span><span class="n">details</span><span class="o">&gt;</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="n">The</span> <span class="n">create_mask_raster</span> <span class="n">function</span> <span class="ow">is</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">create_value_raster</span> <span class="n">but</span> <span class="n">generates</span> <span class="n">a</span> <span class="n">mask</span> <span class="n">raster</span> <span class="n">file</span> <span class="k">with</span> <span class="n">different</span> <span class="n">values</span><span class="o">.</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="o">&lt;</span><span class="n">details</span><span class="o">&gt;</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="o">&lt;</span><span class="n">summary</span><span class="o">&gt;</span><span class="n">Code</span><span class="o">&lt;/</span><span class="n">summary</span><span class="o">&gt;</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="err">```</span><span class="n">python</span> <span class="n">linenums</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29"></a>    <span class="n">create_value_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;value_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30"></a>    <span class="n">create_mask_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;mask_raster.tif&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>The main function is the entry point of the script. It attempts to create an "output" directory using os.makedirs. If the directory already exists, it will raise an exception which is printed to the console. Then, it calls the create_value_raster and create_mask_raster functions to create the value and mask raster files within the "output" directory.</p>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>Finally, if <strong>name</strong> == "<strong>main</strong>": ensures that the main function is executed only when the script is run directly, not when imported as a module.</p>
<p>Usefulness: This code is useful for generating test raster files for geospatial data processing tasks. It showcases the use of the GDAL library to create raster files with specific dimensions, data types, geotransform parameters, and spatial reference information. The generated raster files can be used as sample data for testing and developing algorithms, models, or applications that work with geospatial data.</p>
<h2 id="improving-the-code">Improving the code</h2>
<p>Now I would like to introduce some improvements in my code. I would like to introduce some type declarations for the functions, and also a nicely formatted docstring with parameters and return values specified. Let's do it.</p>
<p align="center">
      <img src="./../chat_gpt_2_question.png" alt="Centered Image">
      <br>
</p>

<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span>
<span class="normal"><a href="#__codelineno-6-68">68</a></span>
<span class="normal"><a href="#__codelineno-6-69">69</a></span>
<span class="normal"><a href="#__codelineno-6-70">70</a></span>
<span class="normal"><a href="#__codelineno-6-71">71</a></span>
<span class="normal"><a href="#__codelineno-6-72">72</a></span>
<span class="normal"><a href="#__codelineno-6-73">73</a></span>
<span class="normal"><a href="#__codelineno-6-74">74</a></span>
<span class="normal"><a href="#__codelineno-6-75">75</a></span>
<span class="normal"><a href="#__codelineno-6-76">76</a></span>
<span class="normal"><a href="#__codelineno-6-77">77</a></span>
<span class="normal"><a href="#__codelineno-6-78">78</a></span>
<span class="normal"><a href="#__codelineno-6-79">79</a></span>
<span class="normal"><a href="#__codelineno-6-80">80</a></span>
<span class="normal"><a href="#__codelineno-6-81">81</a></span>
<span class="normal"><a href="#__codelineno-6-82">82</a></span>
<span class="normal"><a href="#__codelineno-6-83">83</a></span>
<span class="normal"><a href="#__codelineno-6-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="c1"># Constants for file creation</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">dtype</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="n">driver_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="n">geotransform</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000020</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">]</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">x_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="n">y_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="k">def</span> <span class="nf">create_value_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="sd">    Creates a test raster file.</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="sd">    Args:</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="sd">        filename (str): The name of the output raster file.</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="sd">    Returns:</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="sd">        None</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26"></a>    <span class="n">driver</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27"></a>    <span class="n">dst_ds</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="n">x_size</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="n">y_size</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29"></a>    <span class="n">srs</span><span class="p">:</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33"></a>    <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_size</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_size</span><span class="p">)])</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36"></a>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37"></a>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="k">def</span> <span class="nf">create_mask_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="sd">    Creates a mask raster file.</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41"></a>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="sd">    Args:</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="sd">        filename (str): The name of the output raster file.</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44"></a>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="sd">    Returns:</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="sd">        None</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48"></a>    <span class="n">driver</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver_name</span><span class="p">)</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49"></a>    <span class="n">dst_ds</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eType</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51"></a>    <span class="n">srs</span><span class="p">:</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetUTM</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53"></a>    <span class="n">srs</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55"></a>    <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56"></a>        <span class="p">[</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57"></a>            <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58"></a>            <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59"></a>            <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">],</span>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62"></a>        <span class="p">]</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63"></a>    <span class="p">)</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64"></a>    <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65"></a>    <span class="n">dst_ds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66"></a>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67"></a>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68"></a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="sd">    Main function that creates the value and mask raster files.</span>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71"></a>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="sd">    Returns:</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="sd">        None</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79"></a>    <span class="n">create_value_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;value_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80"></a>    <span class="n">create_mask_raster</span><span class="p">(</span><span class="s2">&quot;output&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;mask_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81"></a>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82"></a>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>Of course the code now looks better with type declarations and a docstring showing the arguments and</p>
<p>their type, as well as the return values. </p>
<p>Let's see if it can make some changes to a test suite I created within the directory. By now, the test suit runs correctly, however I would like to test Chat-GPT to introduce some changes. </p>
<h2 id="test-code">Test Code</h2>
<p>The next code snippet is the contents of a file called text_pixel_stats.py:</p>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">  1</a></span>
<span class="normal"><a href="#__codelineno-7-2">  2</a></span>
<span class="normal"><a href="#__codelineno-7-3">  3</a></span>
<span class="normal"><a href="#__codelineno-7-4">  4</a></span>
<span class="normal"><a href="#__codelineno-7-5">  5</a></span>
<span class="normal"><a href="#__codelineno-7-6">  6</a></span>
<span class="normal"><a href="#__codelineno-7-7">  7</a></span>
<span class="normal"><a href="#__codelineno-7-8">  8</a></span>
<span class="normal"><a href="#__codelineno-7-9">  9</a></span>
<span class="normal"><a href="#__codelineno-7-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-7-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-7-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-7-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-7-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-7-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-7-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-7-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-7-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-7-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-7-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-7-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-7-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-7-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-7-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-7-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-7-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-7-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-7-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-7-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-7-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-7-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-7-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-7-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-7-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-7-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-7-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-7-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-7-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-7-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-7-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-7-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-7-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-7-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-7-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-7-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-7-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-7-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-7-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-7-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-7-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-7-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-7-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-7-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-7-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-7-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-7-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-7-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-7-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-7-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-7-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-7-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-7-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-7-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-7-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-7-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-7-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-7-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-7-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-7-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-7-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-7-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-7-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-7-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-7-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-7-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-7-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-7-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-7-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-7-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-7-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-7-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-7-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-7-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-7-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-7-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-7-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-7-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-7-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-7-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-7-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-7-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-7-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-7-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-7-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-7-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-7-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-7-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-7-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-7-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-7-100">100</a></span>
<span class="normal"><a href="#__codelineno-7-101">101</a></span>
<span class="normal"><a href="#__codelineno-7-102">102</a></span>
<span class="normal"><a href="#__codelineno-7-103">103</a></span>
<span class="normal"><a href="#__codelineno-7-104">104</a></span>
<span class="normal"><a href="#__codelineno-7-105">105</a></span>
<span class="normal"><a href="#__codelineno-7-106">106</a></span>
<span class="normal"><a href="#__codelineno-7-107">107</a></span>
<span class="normal"><a href="#__codelineno-7-108">108</a></span>
<span class="normal"><a href="#__codelineno-7-109">109</a></span>
<span class="normal"><a href="#__codelineno-7-110">110</a></span>
<span class="normal"><a href="#__codelineno-7-111">111</a></span>
<span class="normal"><a href="#__codelineno-7-112">112</a></span>
<span class="normal"><a href="#__codelineno-7-113">113</a></span>
<span class="normal"><a href="#__codelineno-7-114">114</a></span>
<span class="normal"><a href="#__codelineno-7-115">115</a></span>
<span class="normal"><a href="#__codelineno-7-116">116</a></span>
<span class="normal"><a href="#__codelineno-7-117">117</a></span>
<span class="normal"><a href="#__codelineno-7-118">118</a></span>
<span class="normal"><a href="#__codelineno-7-119">119</a></span>
<span class="normal"><a href="#__codelineno-7-120">120</a></span>
<span class="normal"><a href="#__codelineno-7-121">121</a></span>
<span class="normal"><a href="#__codelineno-7-122">122</a></span>
<span class="normal"><a href="#__codelineno-7-123">123</a></span>
<span class="normal"><a href="#__codelineno-7-124">124</a></span>
<span class="normal"><a href="#__codelineno-7-125">125</a></span>
<span class="normal"><a href="#__codelineno-7-126">126</a></span>
<span class="normal"><a href="#__codelineno-7-127">127</a></span>
<span class="normal"><a href="#__codelineno-7-128">128</a></span>
<span class="normal"><a href="#__codelineno-7-129">129</a></span>
<span class="normal"><a href="#__codelineno-7-130">130</a></span>
<span class="normal"><a href="#__codelineno-7-131">131</a></span>
<span class="normal"><a href="#__codelineno-7-132">132</a></span>
<span class="normal"><a href="#__codelineno-7-133">133</a></span>
<span class="normal"><a href="#__codelineno-7-134">134</a></span>
<span class="normal"><a href="#__codelineno-7-135">135</a></span>
<span class="normal"><a href="#__codelineno-7-136">136</a></span>
<span class="normal"><a href="#__codelineno-7-137">137</a></span>
<span class="normal"><a href="#__codelineno-7-138">138</a></span>
<span class="normal"><a href="#__codelineno-7-139">139</a></span>
<span class="normal"><a href="#__codelineno-7-140">140</a></span>
<span class="normal"><a href="#__codelineno-7-141">141</a></span>
<span class="normal"><a href="#__codelineno-7-142">142</a></span>
<span class="normal"><a href="#__codelineno-7-143">143</a></span>
<span class="normal"><a href="#__codelineno-7-144">144</a></span>
<span class="normal"><a href="#__codelineno-7-145">145</a></span>
<span class="normal"><a href="#__codelineno-7-146">146</a></span>
<span class="normal"><a href="#__codelineno-7-147">147</a></span>
<span class="normal"><a href="#__codelineno-7-148">148</a></span>
<span class="normal"><a href="#__codelineno-7-149">149</a></span>
<span class="normal"><a href="#__codelineno-7-150">150</a></span>
<span class="normal"><a href="#__codelineno-7-151">151</a></span>
<span class="normal"><a href="#__codelineno-7-152">152</a></span>
<span class="normal"><a href="#__codelineno-7-153">153</a></span>
<span class="normal"><a href="#__codelineno-7-154">154</a></span>
<span class="normal"><a href="#__codelineno-7-155">155</a></span>
<span class="normal"><a href="#__codelineno-7-156">156</a></span>
<span class="normal"><a href="#__codelineno-7-157">157</a></span>
<span class="normal"><a href="#__codelineno-7-158">158</a></span>
<span class="normal"><a href="#__codelineno-7-159">159</a></span>
<span class="normal"><a href="#__codelineno-7-160">160</a></span>
<span class="normal"><a href="#__codelineno-7-161">161</a></span>
<span class="normal"><a href="#__codelineno-7-162">162</a></span>
<span class="normal"><a href="#__codelineno-7-163">163</a></span>
<span class="normal"><a href="#__codelineno-7-164">164</a></span>
<span class="normal"><a href="#__codelineno-7-165">165</a></span>
<span class="normal"><a href="#__codelineno-7-166">166</a></span>
<span class="normal"><a href="#__codelineno-7-167">167</a></span>
<span class="normal"><a href="#__codelineno-7-168">168</a></span>
<span class="normal"><a href="#__codelineno-7-169">169</a></span>
<span class="normal"><a href="#__codelineno-7-170">170</a></span>
<span class="normal"><a href="#__codelineno-7-171">171</a></span>
<span class="normal"><a href="#__codelineno-7-172">172</a></span>
<span class="normal"><a href="#__codelineno-7-173">173</a></span>
<span class="normal"><a href="#__codelineno-7-174">174</a></span>
<span class="normal"><a href="#__codelineno-7-175">175</a></span>
<span class="normal"><a href="#__codelineno-7-176">176</a></span>
<span class="normal"><a href="#__codelineno-7-177">177</a></span>
<span class="normal"><a href="#__codelineno-7-178">178</a></span>
<span class="normal"><a href="#__codelineno-7-179">179</a></span>
<span class="normal"><a href="#__codelineno-7-180">180</a></span>
<span class="normal"><a href="#__codelineno-7-181">181</a></span>
<span class="normal"><a href="#__codelineno-7-182">182</a></span>
<span class="normal"><a href="#__codelineno-7-183">183</a></span>
<span class="normal"><a href="#__codelineno-7-184">184</a></span>
<span class="normal"><a href="#__codelineno-7-185">185</a></span>
<span class="normal"><a href="#__codelineno-7-186">186</a></span>
<span class="normal"><a href="#__codelineno-7-187">187</a></span>
<span class="normal"><a href="#__codelineno-7-188">188</a></span>
<span class="normal"><a href="#__codelineno-7-189">189</a></span>
<span class="normal"><a href="#__codelineno-7-190">190</a></span>
<span class="normal"><a href="#__codelineno-7-191">191</a></span>
<span class="normal"><a href="#__codelineno-7-192">192</a></span>
<span class="normal"><a href="#__codelineno-7-193">193</a></span>
<span class="normal"><a href="#__codelineno-7-194">194</a></span>
<span class="normal"><a href="#__codelineno-7-195">195</a></span>
<span class="normal"><a href="#__codelineno-7-196">196</a></span>
<span class="normal"><a href="#__codelineno-7-197">197</a></span>
<span class="normal"><a href="#__codelineno-7-198">198</a></span>
<span class="normal"><a href="#__codelineno-7-199">199</a></span>
<span class="normal"><a href="#__codelineno-7-200">200</a></span>
<span class="normal"><a href="#__codelineno-7-201">201</a></span>
<span class="normal"><a href="#__codelineno-7-202">202</a></span>
<span class="normal"><a href="#__codelineno-7-203">203</a></span>
<span class="normal"><a href="#__codelineno-7-204">204</a></span>
<span class="normal"><a href="#__codelineno-7-205">205</a></span>
<span class="normal"><a href="#__codelineno-7-206">206</a></span>
<span class="normal"><a href="#__codelineno-7-207">207</a></span>
<span class="normal"><a href="#__codelineno-7-208">208</a></span>
<span class="normal"><a href="#__codelineno-7-209">209</a></span>
<span class="normal"><a href="#__codelineno-7-210">210</a></span>
<span class="normal"><a href="#__codelineno-7-211">211</a></span>
<span class="normal"><a href="#__codelineno-7-212">212</a></span>
<span class="normal"><a href="#__codelineno-7-213">213</a></span>
<span class="normal"><a href="#__codelineno-7-214">214</a></span>
<span class="normal"><a href="#__codelineno-7-215">215</a></span>
<span class="normal"><a href="#__codelineno-7-216">216</a></span>
<span class="normal"><a href="#__codelineno-7-217">217</a></span>
<span class="normal"><a href="#__codelineno-7-218">218</a></span>
<span class="normal"><a href="#__codelineno-7-219">219</a></span>
<span class="normal"><a href="#__codelineno-7-220">220</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kn">import</span> <span class="nn">unittest</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="k">def</span> <span class="nf">return_index_2D_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span> 
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the index for valid data in array,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="sd">    as a lists of tuple, with every tuple</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="sd">    containing the valid coordinate positions</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="sd">    in image for every pixel&quot;&quot;&quot;</span> 
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="n">result</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="n">listOfCoordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="k">return</span> <span class="n">listOfCoordinates</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="k">def</span> <span class="nf">return_image_coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">gt</span><span class="p">):</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="sd">    From pixel coordinates (x,y) returns</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="sd">    the image coordinate. It needs the</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="sd">    Geotransform parameters as list (gt)</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30"></a>    <span class="n">xoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31"></a>    <span class="n">px_w</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32"></a>    <span class="n">rot1</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33"></a>    <span class="n">yoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34"></a>    <span class="n">rot2</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35"></a>    <span class="n">px_h</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36"></a>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37"></a>    <span class="n">xgeo</span> <span class="o">=</span> <span class="n">px_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rot1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">xoffset</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38"></a>    <span class="n">ygeo</span> <span class="o">=</span> <span class="n">rot2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">px_h</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yoffset</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39"></a>    <span class="n">xgeo</span> <span class="o">+=</span> <span class="n">px_w</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40"></a>    <span class="n">ygeo</span> <span class="o">+=</span> <span class="n">px_h</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41"></a>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42"></a>    <span class="k">return</span> <span class="n">xgeo</span><span class="p">,</span> <span class="n">ygeo</span> 
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43"></a>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44"></a>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="k">class</span> <span class="nc">TestPixelStats</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46"></a>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47"></a>    <span class="k">def</span> <span class="nf">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr1</span><span class="p">,</span> <span class="n">pixel_val</span><span class="p">):</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48"></a>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a bool mask, related to invalid</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="sd">        pixels in an array. True belong a valid</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="sd">        pixels, where &#39;pixel_value&#39; is not found&quot;&quot;&quot;</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52"></a>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">arr1</span> <span class="o">!=</span> <span class="n">pixel_val</span><span class="p">))</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54"></a>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55"></a>        <span class="k">return</span> <span class="n">mask</span> 
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56"></a>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57"></a>
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58"></a>    <span class="k">def</span> <span class="nf">change_dtype_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span> 
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59"></a>
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes the data type of array&quot;&quot;&quot;</span>
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61"></a>        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62"></a>
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63"></a>
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64"></a>    <span class="k">def</span> <span class="nf">return_index_2D_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span> 
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65"></a>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the index for valid data in array,</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="sd">        as a lists of tuple, with every tuple</span>
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="sd">        containing the valid coordinate positions</span>
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="sd">        in image for every pixel&quot;&quot;&quot;</span> 
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70"></a>
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71"></a>        <span class="n">result</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72"></a>        <span class="n">rows</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73"></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-74"><a id="__codelineno-7-74" name="__codelineno-7-74"></a>        <span class="n">listOfCoordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
</span><span id="__span-7-75"><a id="__codelineno-7-75" name="__codelineno-7-75"></a>        <span class="k">return</span> <span class="n">listOfCoordinates</span>
</span><span id="__span-7-76"><a id="__codelineno-7-76" name="__codelineno-7-76"></a>
</span><span id="__span-7-77"><a id="__codelineno-7-77" name="__codelineno-7-77"></a>    <span class="k">def</span> <span class="nf">return_image_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">gt</span><span class="p">):</span>
</span><span id="__span-7-78"><a id="__codelineno-7-78" name="__codelineno-7-78"></a>
</span><span id="__span-7-79"><a id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-80"><a id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="sd">        From pixel coordinates (x,y) returns</span>
</span><span id="__span-7-81"><a id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="sd">        the image coordinate. It needs the</span>
</span><span id="__span-7-82"><a id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="sd">        Geotransform parameters as list (gt)</span>
</span><span id="__span-7-83"><a id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-7-84"><a id="__codelineno-7-84" name="__codelineno-7-84"></a>        <span class="n">xoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-85"><a id="__codelineno-7-85" name="__codelineno-7-85"></a>        <span class="n">px_w</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-86"><a id="__codelineno-7-86" name="__codelineno-7-86"></a>        <span class="n">rot1</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-7-87"><a id="__codelineno-7-87" name="__codelineno-7-87"></a>        <span class="n">yoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-7-88"><a id="__codelineno-7-88" name="__codelineno-7-88"></a>        <span class="n">rot2</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-7-89"><a id="__codelineno-7-89" name="__codelineno-7-89"></a>        <span class="n">px_h</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-7-90"><a id="__codelineno-7-90" name="__codelineno-7-90"></a>
</span><span id="__span-7-91"><a id="__codelineno-7-91" name="__codelineno-7-91"></a>        <span class="n">xgeo</span> <span class="o">=</span> <span class="n">px_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rot1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">xoffset</span>
</span><span id="__span-7-92"><a id="__codelineno-7-92" name="__codelineno-7-92"></a>        <span class="n">ygeo</span> <span class="o">=</span> <span class="n">rot2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">px_h</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yoffset</span>
</span><span id="__span-7-93"><a id="__codelineno-7-93" name="__codelineno-7-93"></a>        <span class="n">xgeo</span> <span class="o">+=</span> <span class="n">px_w</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="__span-7-94"><a id="__codelineno-7-94" name="__codelineno-7-94"></a>        <span class="n">ygeo</span> <span class="o">+=</span> <span class="n">px_h</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-7-95"><a id="__codelineno-7-95" name="__codelineno-7-95"></a>
</span><span id="__span-7-96"><a id="__codelineno-7-96" name="__codelineno-7-96"></a>        <span class="k">return</span> <span class="n">xgeo</span><span class="p">,</span> <span class="n">ygeo</span> 
</span><span id="__span-7-97"><a id="__codelineno-7-97" name="__codelineno-7-97"></a>
</span><span id="__span-7-98"><a id="__codelineno-7-98" name="__codelineno-7-98"></a>
</span><span id="__span-7-99"><a id="__codelineno-7-99" name="__codelineno-7-99"></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
</span><span id="__span-7-100"><a id="__codelineno-7-100" name="__codelineno-7-100"></a>
</span><span id="__span-7-101"><a id="__codelineno-7-101" name="__codelineno-7-101"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; The setup files to run this tests are</span>
</span><span id="__span-7-102"><a id="__codelineno-7-102" name="__codelineno-7-102"></a><span class="sd">        located in the output folder, and they are</span>
</span><span id="__span-7-103"><a id="__codelineno-7-103" name="__codelineno-7-103"></a><span class="sd">        created with the create_test_files.py script</span>
</span><span id="__span-7-104"><a id="__codelineno-7-104" name="__codelineno-7-104"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-7-105"><a id="__codelineno-7-105" name="__codelineno-7-105"></a>
</span><span id="__span-7-106"><a id="__codelineno-7-106" name="__codelineno-7-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_path</span> <span class="o">=</span> <span class="s2">&quot;output/value_raster.tif&quot;</span> 
</span><span id="__span-7-107"><a id="__codelineno-7-107" name="__codelineno-7-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span> <span class="o">=</span> <span class="s2">&quot;output/mask_raster.tif&quot;</span>
</span><span id="__span-7-108"><a id="__codelineno-7-108" name="__codelineno-7-108"></a>
</span><span id="__span-7-109"><a id="__codelineno-7-109" name="__codelineno-7-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values_path</span><span class="p">)</span>
</span><span id="__span-7-110"><a id="__codelineno-7-110" name="__codelineno-7-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span><span class="p">)</span>
</span><span id="__span-7-111"><a id="__codelineno-7-111" name="__codelineno-7-111"></a>
</span><span id="__span-7-112"><a id="__codelineno-7-112" name="__codelineno-7-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>\
</span><span id="__span-7-113"><a id="__codelineno-7-113" name="__codelineno-7-113"></a>                        <span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span> 
</span><span id="__span-7-114"><a id="__codelineno-7-114" name="__codelineno-7-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span>\
</span><span id="__span-7-115"><a id="__codelineno-7-115" name="__codelineno-7-115"></a>                        <span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-7-116"><a id="__codelineno-7-116" name="__codelineno-7-116"></a>
</span><span id="__span-7-117"><a id="__codelineno-7-117" name="__codelineno-7-117"></a>
</span><span id="__span-7-118"><a id="__codelineno-7-118" name="__codelineno-7-118"></a>    <span class="k">def</span> <span class="nf">test_masking_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-7-119"><a id="__codelineno-7-119" name="__codelineno-7-119"></a>
</span><span id="__span-7-120"><a id="__codelineno-7-120" name="__codelineno-7-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if after creating a boolean mask</span>
</span><span id="__span-7-121"><a id="__codelineno-7-121" name="__codelineno-7-121"></a><span class="sd">        with True values returned where valid data</span>
</span><span id="__span-7-122"><a id="__codelineno-7-122" name="__codelineno-7-122"></a><span class="sd">        are located, and False whenever the invalid</span>
</span><span id="__span-7-123"><a id="__codelineno-7-123" name="__codelineno-7-123"></a><span class="sd">        value is found in the array. In this case</span>
</span><span id="__span-7-124"><a id="__codelineno-7-124" name="__codelineno-7-124"></a><span class="sd">        we take 0 as the invalid value&quot;&quot;&quot;</span>
</span><span id="__span-7-125"><a id="__codelineno-7-125" name="__codelineno-7-125"></a>
</span><span id="__span-7-126"><a id="__codelineno-7-126" name="__codelineno-7-126"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-127"><a id="__codelineno-7-127" name="__codelineno-7-127"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-7-128"><a id="__codelineno-7-128" name="__codelineno-7-128"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-129"><a id="__codelineno-7-129" name="__codelineno-7-129"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-7-130"><a id="__codelineno-7-130" name="__codelineno-7-130"></a>                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-7-131"><a id="__codelineno-7-131" name="__codelineno-7-131"></a>                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-7-132"><a id="__codelineno-7-132" name="__codelineno-7-132"></a>                            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-7-133"><a id="__codelineno-7-133" name="__codelineno-7-133"></a>                            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]])</span>
</span><span id="__span-7-134"><a id="__codelineno-7-134" name="__codelineno-7-134"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">should_be</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span> 
</span><span id="__span-7-135"><a id="__codelineno-7-135" name="__codelineno-7-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">should_be</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="__span-7-136"><a id="__codelineno-7-136" name="__codelineno-7-136"></a>
</span><span id="__span-7-137"><a id="__codelineno-7-137" name="__codelineno-7-137"></a>    <span class="k">def</span> <span class="nf">testing_return_index_2D_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
</span><span id="__span-7-138"><a id="__codelineno-7-138" name="__codelineno-7-138"></a>
</span><span id="__span-7-139"><a id="__codelineno-7-139" name="__codelineno-7-139"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates in image are returned</span>
</span><span id="__span-7-140"><a id="__codelineno-7-140" name="__codelineno-7-140"></a><span class="sd">        from a value array. Valid pixels are the ones different</span>
</span><span id="__span-7-141"><a id="__codelineno-7-141" name="__codelineno-7-141"></a><span class="sd">        of 0&quot;&quot;&quot;</span>
</span><span id="__span-7-142"><a id="__codelineno-7-142" name="__codelineno-7-142"></a>
</span><span id="__span-7-143"><a id="__codelineno-7-143" name="__codelineno-7-143"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
</span><span id="__span-7-144"><a id="__codelineno-7-144" name="__codelineno-7-144"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-7-145"><a id="__codelineno-7-145" name="__codelineno-7-145"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-146"><a id="__codelineno-7-146" name="__codelineno-7-146"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-147"><a id="__codelineno-7-147" name="__codelineno-7-147"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-7-148"><a id="__codelineno-7-148" name="__codelineno-7-148"></a>                                <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-7-149"><a id="__codelineno-7-149" name="__codelineno-7-149"></a>                                <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>
</span><span id="__span-7-150"><a id="__codelineno-7-150" name="__codelineno-7-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index_valid_data</span><span class="p">,</span> <span class="n">list_of_coordinates</span><span class="p">)</span>
</span><span id="__span-7-151"><a id="__codelineno-7-151" name="__codelineno-7-151"></a>
</span><span id="__span-7-152"><a id="__codelineno-7-152" name="__codelineno-7-152"></a>
</span><span id="__span-7-153"><a id="__codelineno-7-153" name="__codelineno-7-153"></a>    <span class="k">def</span> <span class="nf">testing_return_pos_coordinates_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-7-154"><a id="__codelineno-7-154" name="__codelineno-7-154"></a>
</span><span id="__span-7-155"><a id="__codelineno-7-155" name="__codelineno-7-155"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates for  a pixel position</span>
</span><span id="__span-7-156"><a id="__codelineno-7-156" name="__codelineno-7-156"></a><span class="sd">        on an image are returned, for valid data. In this case </span>
</span><span id="__span-7-157"><a id="__codelineno-7-157" name="__codelineno-7-157"></a><span class="sd">        no valid data is 0&quot;&quot;&quot;</span>
</span><span id="__span-7-158"><a id="__codelineno-7-158" name="__codelineno-7-158"></a>
</span><span id="__span-7-159"><a id="__codelineno-7-159" name="__codelineno-7-159"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
</span><span id="__span-7-160"><a id="__codelineno-7-160" name="__codelineno-7-160"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-7-161"><a id="__codelineno-7-161" name="__codelineno-7-161"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-7-162"><a id="__codelineno-7-162" name="__codelineno-7-162"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-163"><a id="__codelineno-7-163" name="__codelineno-7-163"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-7-164"><a id="__codelineno-7-164" name="__codelineno-7-164"></a>                                <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-7-165"><a id="__codelineno-7-165" name="__codelineno-7-165"></a>                                <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>
</span><span id="__span-7-166"><a id="__codelineno-7-166" name="__codelineno-7-166"></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span> 
</span><span id="__span-7-167"><a id="__codelineno-7-167" name="__codelineno-7-167"></a>        <span class="n">test_posx</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-168"><a id="__codelineno-7-168" name="__codelineno-7-168"></a>        <span class="n">test_posy</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-169"><a id="__codelineno-7-169" name="__codelineno-7-169"></a>        <span class="n">geo_posx</span><span class="p">,</span> <span class="n">geo_posy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_image_coordinate</span><span class="p">(</span><span class="n">test_posx</span><span class="p">,</span>\
</span><span id="__span-7-170"><a id="__codelineno-7-170" name="__codelineno-7-170"></a>                                                        <span class="n">test_posy</span><span class="p">,</span>\
</span><span id="__span-7-171"><a id="__codelineno-7-171" name="__codelineno-7-171"></a>                                                        <span class="n">gt</span><span class="p">)</span>
</span><span id="__span-7-172"><a id="__codelineno-7-172" name="__codelineno-7-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posx</span><span class="p">,</span> <span class="mi">300005</span><span class="p">)</span>
</span><span id="__span-7-173"><a id="__codelineno-7-173" name="__codelineno-7-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posy</span><span class="p">,</span> <span class="mi">1000015</span><span class="p">)</span>
</span><span id="__span-7-174"><a id="__codelineno-7-174" name="__codelineno-7-174"></a>
</span><span id="__span-7-175"><a id="__codelineno-7-175" name="__codelineno-7-175"></a>
</span><span id="__span-7-176"><a id="__codelineno-7-176" name="__codelineno-7-176"></a><span class="k">class</span> <span class="nc">TestPixelStats</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-7-177"><a id="__codelineno-7-177" name="__codelineno-7-177"></a>
</span><span id="__span-7-178"><a id="__codelineno-7-178" name="__codelineno-7-178"></a>    <span class="k">def</span> <span class="nf">testing_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
</span><span id="__span-7-179"><a id="__codelineno-7-179" name="__codelineno-7-179"></a>
</span><span id="__span-7-180"><a id="__codelineno-7-180" name="__codelineno-7-180"></a>        <span class="n">values_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;output/value_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-7-181"><a id="__codelineno-7-181" name="__codelineno-7-181"></a>        <span class="n">mask_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;output/mask_raster.tif&quot;</span><span class="p">)</span>
</span><span id="__span-7-182"><a id="__codelineno-7-182" name="__codelineno-7-182"></a>
</span><span id="__span-7-183"><a id="__codelineno-7-183" name="__codelineno-7-183"></a>        <span class="c1">## Masking out valid data from mask raster </span>
</span><span id="__span-7-184"><a id="__codelineno-7-184" name="__codelineno-7-184"></a>        <span class="c1">## output/mask_raster.tif plays the role that </span>
</span><span id="__span-7-185"><a id="__codelineno-7-185" name="__codelineno-7-185"></a>        <span class="c1">## the rasterized version of the vector with </span>
</span><span id="__span-7-186"><a id="__codelineno-7-186" name="__codelineno-7-186"></a>        <span class="c1">## the &quot;burned&quot; class column, that will become</span>
</span><span id="__span-7-187"><a id="__codelineno-7-187" name="__codelineno-7-187"></a>        <span class="c1">## the raster values </span>
</span><span id="__span-7-188"><a id="__codelineno-7-188" name="__codelineno-7-188"></a>
</span><span id="__span-7-189"><a id="__codelineno-7-189" name="__codelineno-7-189"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Reading arrays for Values, FID and Proximity --&quot;</span><span class="p">)</span>
</span><span id="__span-7-190"><a id="__codelineno-7-190" name="__codelineno-7-190"></a>        <span class="n">values_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>\
</span><span id="__span-7-191"><a id="__codelineno-7-191" name="__codelineno-7-191"></a>                        <span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-7-192"><a id="__codelineno-7-192" name="__codelineno-7-192"></a>        <span class="n">mask_arr_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>\
</span><span id="__span-7-193"><a id="__codelineno-7-193" name="__codelineno-7-193"></a>                        <span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-7-194"><a id="__codelineno-7-194" name="__codelineno-7-194"></a>
</span><span id="__span-7-195"><a id="__codelineno-7-195" name="__codelineno-7-195"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Extracting only valid data and fid --&quot;</span><span class="p">)</span>
</span><span id="__span-7-196"><a id="__codelineno-7-196" name="__codelineno-7-196"></a>        <span class="n">values_arr</span> <span class="o">=</span> <span class="n">values_arr</span><span class="p">[</span><span class="n">mask_arr_original</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> 
</span><span id="__span-7-197"><a id="__codelineno-7-197" name="__codelineno-7-197"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">values_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-7-198"><a id="__codelineno-7-198" name="__codelineno-7-198"></a>        <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">mask_arr_original</span><span class="p">[</span><span class="n">mask_arr_original</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-199"><a id="__codelineno-7-199" name="__codelineno-7-199"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">mask_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-7-200"><a id="__codelineno-7-200" name="__codelineno-7-200"></a>
</span><span id="__span-7-201"><a id="__codelineno-7-201" name="__codelineno-7-201"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Getting xcoor and ycoor for pixels --&quot;</span><span class="p">)</span>
</span><span id="__span-7-202"><a id="__codelineno-7-202" name="__codelineno-7-202"></a>        <span class="n">gt</span> <span class="o">=</span> <span class="n">mask_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span> 
</span><span id="__span-7-203"><a id="__codelineno-7-203" name="__codelineno-7-203"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">mask_arr_original</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-204"><a id="__codelineno-7-204" name="__codelineno-7-204"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">index_valid_data</span><span class="p">)</span> 
</span><span id="__span-7-205"><a id="__codelineno-7-205" name="__codelineno-7-205"></a>        <span class="n">coor_valid_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">return_image_coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_valid_data</span><span class="p">])</span>
</span><span id="__span-7-206"><a id="__codelineno-7-206" name="__codelineno-7-206"></a>        <span class="n">x_coor_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">coor_valid_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
</span><span id="__span-7-207"><a id="__codelineno-7-207" name="__codelineno-7-207"></a>        <span class="n">y_coor_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">coor_valid_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
</span><span id="__span-7-208"><a id="__codelineno-7-208" name="__codelineno-7-208"></a>
</span><span id="__span-7-209"><a id="__codelineno-7-209" name="__codelineno-7-209"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">x_coor_</span><span class="p">)</span>
</span><span id="__span-7-210"><a id="__codelineno-7-210" name="__codelineno-7-210"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">y_coor_</span><span class="p">)</span>
</span><span id="__span-7-211"><a id="__codelineno-7-211" name="__codelineno-7-211"></a>
</span><span id="__span-7-212"><a id="__codelineno-7-212" name="__codelineno-7-212"></a>        <span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values_arr</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TF_VALUE&quot;</span><span class="p">])</span>
</span><span id="__span-7-213"><a id="__codelineno-7-213" name="__codelineno-7-213"></a>        <span class="n">Data</span><span class="p">[</span><span class="s2">&quot;FID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_arr</span>
</span><span id="__span-7-214"><a id="__codelineno-7-214" name="__codelineno-7-214"></a>        <span class="n">Data</span><span class="p">[</span><span class="s2">&quot;X_coor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_coor_</span>
</span><span id="__span-7-215"><a id="__codelineno-7-215" name="__codelineno-7-215"></a>        <span class="n">Data</span><span class="p">[</span><span class="s2">&quot;Y_coor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_coor_</span>
</span><span id="__span-7-216"><a id="__codelineno-7-216" name="__codelineno-7-216"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
</span><span id="__span-7-217"><a id="__codelineno-7-217" name="__codelineno-7-217"></a>
</span><span id="__span-7-218"><a id="__codelineno-7-218" name="__codelineno-7-218"></a>
</span><span id="__span-7-219"><a id="__codelineno-7-219" name="__codelineno-7-219"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-7-220"><a id="__codelineno-7-220" name="__codelineno-7-220"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>Even though the function works, there is a couple of things that I don't like about my past code. First I declared some functions, that I copy 1:1 as methods within the Test Suite. I would like to get rid of these code duplication. </p>
<p align="center">
      <img src="./../chat_gpt_3_question.png" alt="Centered Image">
      <br>
</p>

<p>The following is the code generated by the prompt:</p>
<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">  1</a></span>
<span class="normal"><a href="#__codelineno-8-2">  2</a></span>
<span class="normal"><a href="#__codelineno-8-3">  3</a></span>
<span class="normal"><a href="#__codelineno-8-4">  4</a></span>
<span class="normal"><a href="#__codelineno-8-5">  5</a></span>
<span class="normal"><a href="#__codelineno-8-6">  6</a></span>
<span class="normal"><a href="#__codelineno-8-7">  7</a></span>
<span class="normal"><a href="#__codelineno-8-8">  8</a></span>
<span class="normal"><a href="#__codelineno-8-9">  9</a></span>
<span class="normal"><a href="#__codelineno-8-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-8-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-8-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-8-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-8-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-8-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-8-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-8-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-8-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-8-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-8-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-8-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-8-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-8-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-8-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-8-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-8-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-8-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-8-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-8-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-8-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-8-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-8-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-8-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-8-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-8-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-8-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-8-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-8-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-8-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-8-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-8-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-8-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-8-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-8-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-8-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-8-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-8-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-8-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-8-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-8-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-8-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-8-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-8-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-8-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-8-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-8-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-8-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-8-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-8-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-8-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-8-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-8-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-8-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-8-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-8-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-8-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-8-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-8-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-8-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-8-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-8-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-8-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-8-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-8-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-8-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-8-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-8-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-8-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-8-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-8-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-8-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-8-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-8-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-8-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-8-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-8-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-8-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-8-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-8-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-8-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-8-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-8-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-8-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-8-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-8-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-8-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-8-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-8-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-8-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-8-100">100</a></span>
<span class="normal"><a href="#__codelineno-8-101">101</a></span>
<span class="normal"><a href="#__codelineno-8-102">102</a></span>
<span class="normal"><a href="#__codelineno-8-103">103</a></span>
<span class="normal"><a href="#__codelineno-8-104">104</a></span>
<span class="normal"><a href="#__codelineno-8-105">105</a></span>
<span class="normal"><a href="#__codelineno-8-106">106</a></span>
<span class="normal"><a href="#__codelineno-8-107">107</a></span>
<span class="normal"><a href="#__codelineno-8-108">108</a></span>
<span class="normal"><a href="#__codelineno-8-109">109</a></span>
<span class="normal"><a href="#__codelineno-8-110">110</a></span>
<span class="normal"><a href="#__codelineno-8-111">111</a></span>
<span class="normal"><a href="#__codelineno-8-112">112</a></span>
<span class="normal"><a href="#__codelineno-8-113">113</a></span>
<span class="normal"><a href="#__codelineno-8-114">114</a></span>
<span class="normal"><a href="#__codelineno-8-115">115</a></span>
<span class="normal"><a href="#__codelineno-8-116">116</a></span>
<span class="normal"><a href="#__codelineno-8-117">117</a></span>
<span class="normal"><a href="#__codelineno-8-118">118</a></span>
<span class="normal"><a href="#__codelineno-8-119">119</a></span>
<span class="normal"><a href="#__codelineno-8-120">120</a></span>
<span class="normal"><a href="#__codelineno-8-121">121</a></span>
<span class="normal"><a href="#__codelineno-8-122">122</a></span>
<span class="normal"><a href="#__codelineno-8-123">123</a></span>
<span class="normal"><a href="#__codelineno-8-124">124</a></span>
<span class="normal"><a href="#__codelineno-8-125">125</a></span>
<span class="normal"><a href="#__codelineno-8-126">126</a></span>
<span class="normal"><a href="#__codelineno-8-127">127</a></span>
<span class="normal"><a href="#__codelineno-8-128">128</a></span>
<span class="normal"><a href="#__codelineno-8-129">129</a></span>
<span class="normal"><a href="#__codelineno-8-130">130</a></span>
<span class="normal"><a href="#__codelineno-8-131">131</a></span>
<span class="normal"><a href="#__codelineno-8-132">132</a></span>
<span class="normal"><a href="#__codelineno-8-133">133</a></span>
<span class="normal"><a href="#__codelineno-8-134">134</a></span>
<span class="normal"><a href="#__codelineno-8-135">135</a></span>
<span class="normal"><a href="#__codelineno-8-136">136</a></span>
<span class="normal"><a href="#__codelineno-8-137">137</a></span>
<span class="normal"><a href="#__codelineno-8-138">138</a></span>
<span class="normal"><a href="#__codelineno-8-139">139</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span> <span class="nn">unittest</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="k">def</span> <span class="nf">return_index_2D_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the index for valid data in an array,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="sd">    as a list of tuples, with each tuple containing the</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="sd">    coordinates of valid data in the image for each pixel&quot;&quot;&quot;</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a>    <span class="n">listOfCoordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a>    <span class="k">return</span> <span class="n">listOfCoordinates</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="k">def</span> <span class="nf">return_image_coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">gt</span><span class="p">):</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="sd">    From pixel coordinates (x,y), returns</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="sd">    the image coordinates. It requires the</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="sd">    Geotransform parameters as a list (gt).</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27"></a>    <span class="n">xoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28"></a>    <span class="n">px_w</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29"></a>    <span class="n">rot1</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30"></a>    <span class="n">yoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31"></a>    <span class="n">rot2</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32"></a>    <span class="n">px_h</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33"></a>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34"></a>    <span class="n">xgeo</span> <span class="o">=</span> <span class="n">px_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rot1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">xoffset</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35"></a>    <span class="n">ygeo</span> <span class="o">=</span> <span class="n">rot2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">px_h</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yoffset</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36"></a>    <span class="n">xgeo</span> <span class="o">+=</span> <span class="n">px_w</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37"></a>    <span class="n">ygeo</span> <span class="o">+=</span> <span class="n">px_h</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38"></a>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39"></a>    <span class="k">return</span> <span class="n">xgeo</span><span class="p">,</span> <span class="n">ygeo</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40"></a>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41"></a>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="k">class</span> <span class="nc">TestPixelStats</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43"></a>    <span class="k">def</span> <span class="nf">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr1</span><span class="p">,</span> <span class="n">pixel_val</span><span class="p">):</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a boolean mask related to invalid</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45"></a><span class="sd">        pixels in an array. True belongs to valid</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46"></a><span class="sd">        pixels, where &#39;pixel_value&#39; is not found&quot;&quot;&quot;</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">!=</span> <span class="n">pixel_val</span>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48"></a>        <span class="k">return</span> <span class="n">mask</span>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49"></a>
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50"></a>    <span class="k">def</span> <span class="nf">change_dtype_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes the data type of an array&quot;&quot;&quot;</span>
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52"></a>        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53"></a>
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54"></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The setup files to run these tests are</span>
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="sd">        located in the output folder and are created</span>
</span><span id="__span-8-57"><a id="__codelineno-8-57" name="__codelineno-8-57"></a><span class="sd">        with the create_test_files.py script&quot;&quot;&quot;</span>
</span><span id="__span-8-58"><a id="__codelineno-8-58" name="__codelineno-8-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_path</span> <span class="o">=</span> <span class="s2">&quot;output/value_raster.tif&quot;</span>
</span><span id="__span-8-59"><a id="__codelineno-8-59" name="__codelineno-8-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span> <span class="o">=</span> <span class="s2">&quot;output/mask_raster.tif&quot;</span>
</span><span id="__span-8-60"><a id="__codelineno-8-60" name="__codelineno-8-60"></a>
</span><span id="__span-8-61"><a id="__codelineno-8-61" name="__codelineno-8-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values_path</span><span class="p">)</span>
</span><span id="__span-8-62"><a id="__codelineno-8-62" name="__codelineno-8-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span><span class="p">)</span>
</span><span id="__span-8-63"><a id="__codelineno-8-63" name="__codelineno-8-63"></a>
</span><span id="__span-8-64"><a id="__codelineno-8-64" name="__codelineno-8-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-8-65"><a id="__codelineno-8-65" name="__codelineno-8-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-8-66"><a id="__codelineno-8-66" name="__codelineno-8-66"></a>
</span><span id="__span-8-67"><a id="__codelineno-8-67" name="__codelineno-8-67"></a>    <span class="k">def</span> <span class="nf">test_masking_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-68"><a id="__codelineno-8-68" name="__codelineno-8-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if after creating a boolean mask</span>
</span><span id="__span-8-69"><a id="__codelineno-8-69" name="__codelineno-8-69"></a><span class="sd">        with True values returned where valid data</span>
</span><span id="__span-8-70"><a id="__codelineno-8-70" name="__codelineno-8-70"></a><span class="sd">        are located, and False whenever the invalid</span>
</span><span id="__span-8-71"><a id="__codelineno-8-71" name="__codelineno-8-71"></a><span class="sd">        value is found in the array. In this case,</span>
</span><span id="__span-8-72"><a id="__codelineno-8-72" name="__codelineno-8-72"></a><span class="sd">        we take 0 as the invalid value&quot;&quot;&quot;</span>
</span><span id="__span-8-73"><a id="__codelineno-8-73" name="__codelineno-8-73"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-74"><a id="__codelineno-8-74" name="__codelineno-8-74"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-8-75"><a id="__codelineno-8-75" name="__codelineno-8-75"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-76"><a id="__codelineno-8-76" name="__codelineno-8-76"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="__span-8-77"><a id="__codelineno-8-77" name="__codelineno-8-77"></a>            <span class="p">[</span>
</span><span id="__span-8-78"><a id="__codelineno-8-78" name="__codelineno-8-78"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-8-79"><a id="__codelineno-8-79" name="__codelineno-8-79"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-8-80"><a id="__codelineno-8-80" name="__codelineno-8-80"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-8-81"><a id="__codelineno-8-81" name="__codelineno-8-81"></a>                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-8-82"><a id="__codelineno-8-82" name="__codelineno-8-82"></a>                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-8-83"><a id="__codelineno-8-83" name="__codelineno-8-83"></a>            <span class="p">]</span>
</span><span id="__span-8-84"><a id="__codelineno-8-84" name="__codelineno-8-84"></a>        <span class="p">)</span>
</span><span id="__span-8-85"><a id="__codelineno-8-85" name="__codelineno-8-85"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">should_be</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-86"><a id="__codelineno-8-86" name="__codelineno-8-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">should_be</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="__span-8-87"><a id="__codelineno-8-87" name="__codelineno-8-87"></a>
</span><span id="__span-8-88"><a id="__codelineno-8-88" name="__codelineno-8-88"></a>    <span class="k">def</span> <span class="nf">testing_return_index_2D_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-89"><a id="__codelineno-8-89" name="__codelineno-8-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates in the image are returned</span>
</span><span id="__span-8-90"><a id="__codelineno-8-90" name="__codelineno-8-90"></a><span class="sd">        from a value array. Valid pixels are the ones different</span>
</span><span id="__span-8-91"><a id="__codelineno-8-91" name="__codelineno-8-91"></a><span class="sd">        from 0&quot;&quot;&quot;</span>
</span><span id="__span-8-92"><a id="__codelineno-8-92" name="__codelineno-8-92"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-93"><a id="__codelineno-8-93" name="__codelineno-8-93"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-8-94"><a id="__codelineno-8-94" name="__codelineno-8-94"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-95"><a id="__codelineno-8-95" name="__codelineno-8-95"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-96"><a id="__codelineno-8-96" name="__codelineno-8-96"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-8-97"><a id="__codelineno-8-97" name="__codelineno-8-97"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-98"><a id="__codelineno-8-98" name="__codelineno-8-98"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-99"><a id="__codelineno-8-99" name="__codelineno-8-99"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-100"><a id="__codelineno-8-100" name="__codelineno-8-100"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-101"><a id="__codelineno-8-101" name="__codelineno-8-101"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-8-102"><a id="__codelineno-8-102" name="__codelineno-8-102"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-8-103"><a id="__codelineno-8-103" name="__codelineno-8-103"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-104"><a id="__codelineno-8-104" name="__codelineno-8-104"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-105"><a id="__codelineno-8-105" name="__codelineno-8-105"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-8-106"><a id="__codelineno-8-106" name="__codelineno-8-106"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-8-107"><a id="__codelineno-8-107" name="__codelineno-8-107"></a>        <span class="p">]</span>
</span><span id="__span-8-108"><a id="__codelineno-8-108" name="__codelineno-8-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index_valid_data</span><span class="p">,</span> <span class="n">list_of_coordinates</span><span class="p">)</span>
</span><span id="__span-8-109"><a id="__codelineno-8-109" name="__codelineno-8-109"></a>
</span><span id="__span-8-110"><a id="__codelineno-8-110" name="__codelineno-8-110"></a>    <span class="k">def</span> <span class="nf">testing_return_pos_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-111"><a id="__codelineno-8-111" name="__codelineno-8-111"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates for a pixel position</span>
</span><span id="__span-8-112"><a id="__codelineno-8-112" name="__codelineno-8-112"></a><span class="sd">        on an image are returned for valid data. In this case,</span>
</span><span id="__span-8-113"><a id="__codelineno-8-113" name="__codelineno-8-113"></a><span class="sd">        no valid data is 0&quot;&quot;&quot;</span>
</span><span id="__span-8-114"><a id="__codelineno-8-114" name="__codelineno-8-114"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-115"><a id="__codelineno-8-115" name="__codelineno-8-115"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-8-116"><a id="__codelineno-8-116" name="__codelineno-8-116"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-8-117"><a id="__codelineno-8-117" name="__codelineno-8-117"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-118"><a id="__codelineno-8-118" name="__codelineno-8-118"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-8-119"><a id="__codelineno-8-119" name="__codelineno-8-119"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-120"><a id="__codelineno-8-120" name="__codelineno-8-120"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-121"><a id="__codelineno-8-121" name="__codelineno-8-121"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-122"><a id="__codelineno-8-122" name="__codelineno-8-122"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-123"><a id="__codelineno-8-123" name="__codelineno-8-123"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-8-124"><a id="__codelineno-8-124" name="__codelineno-8-124"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-8-125"><a id="__codelineno-8-125" name="__codelineno-8-125"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-8-126"><a id="__codelineno-8-126" name="__codelineno-8-126"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-8-127"><a id="__codelineno-8-127" name="__codelineno-8-127"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-8-128"><a id="__codelineno-8-128" name="__codelineno-8-128"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-8-129"><a id="__codelineno-8-129" name="__codelineno-8-129"></a>        <span class="p">]</span>
</span><span id="__span-8-130"><a id="__codelineno-8-130" name="__codelineno-8-130"></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</span><span id="__span-8-131"><a id="__codelineno-8-131" name="__codelineno-8-131"></a>        <span class="n">test_posx</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-8-132"><a id="__codelineno-8-132" name="__codelineno-8-132"></a>        <span class="n">test_posy</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-8-133"><a id="__codelineno-8-133" name="__codelineno-8-133"></a>        <span class="n">geo_posx</span><span class="p">,</span> <span class="n">geo_posy</span> <span class="o">=</span> <span class="n">return_image_coordinate</span><span class="p">(</span><span class="n">test_posx</span><span class="p">,</span> <span class="n">test_posy</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span>
</span><span id="__span-8-134"><a id="__codelineno-8-134" name="__codelineno-8-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posx</span><span class="p">,</span> <span class="mi">300005</span><span class="p">)</span>
</span><span id="__span-8-135"><a id="__codelineno-8-135" name="__codelineno-8-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posy</span><span class="p">,</span> <span class="mi">1000015</span><span class="p">)</span>
</span><span id="__span-8-136"><a id="__codelineno-8-136" name="__codelineno-8-136"></a>
</span><span id="__span-8-137"><a id="__codelineno-8-137" name="__codelineno-8-137"></a>
</span><span id="__span-8-138"><a id="__codelineno-8-138" name="__codelineno-8-138"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-8-139"><a id="__codelineno-8-139" name="__codelineno-8-139"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>And the tests still run:</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$ python -m unittest
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>...
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>----------------------------------------------------------------------
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>Ran 3 tests in 0.010s
</span></code></pre></div>
</div>
<h2 id="refactoring-the-test-class">Refactoring the test class</h2>
<p>Another improvement we can introduce is to remove methods, and make them functions outside of the Test Class body. Let's do it.</p>
<p align="center">
      <img src="./../chat_gpt_4_question.png" alt="Centered Image">
      <br>
</p>

<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">  1</a></span>
<span class="normal"><a href="#__codelineno-10-2">  2</a></span>
<span class="normal"><a href="#__codelineno-10-3">  3</a></span>
<span class="normal"><a href="#__codelineno-10-4">  4</a></span>
<span class="normal"><a href="#__codelineno-10-5">  5</a></span>
<span class="normal"><a href="#__codelineno-10-6">  6</a></span>
<span class="normal"><a href="#__codelineno-10-7">  7</a></span>
<span class="normal"><a href="#__codelineno-10-8">  8</a></span>
<span class="normal"><a href="#__codelineno-10-9">  9</a></span>
<span class="normal"><a href="#__codelineno-10-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-10-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-10-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-10-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-10-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-10-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-10-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-10-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-10-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-10-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-10-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-10-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-10-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-10-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-10-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-10-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-10-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-10-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-10-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-10-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-10-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-10-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-10-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-10-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-10-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-10-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-10-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-10-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-10-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-10-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-10-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-10-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-10-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-10-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-10-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-10-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-10-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-10-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-10-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-10-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-10-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-10-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-10-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-10-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-10-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-10-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-10-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-10-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-10-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-10-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-10-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-10-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-10-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-10-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-10-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-10-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-10-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-10-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-10-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-10-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-10-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-10-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-10-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-10-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-10-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-10-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-10-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-10-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-10-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-10-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-10-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-10-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-10-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-10-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-10-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-10-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-10-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-10-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-10-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-10-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-10-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-10-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-10-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-10-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-10-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-10-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-10-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-10-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-10-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-10-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-10-100">100</a></span>
<span class="normal"><a href="#__codelineno-10-101">101</a></span>
<span class="normal"><a href="#__codelineno-10-102">102</a></span>
<span class="normal"><a href="#__codelineno-10-103">103</a></span>
<span class="normal"><a href="#__codelineno-10-104">104</a></span>
<span class="normal"><a href="#__codelineno-10-105">105</a></span>
<span class="normal"><a href="#__codelineno-10-106">106</a></span>
<span class="normal"><a href="#__codelineno-10-107">107</a></span>
<span class="normal"><a href="#__codelineno-10-108">108</a></span>
<span class="normal"><a href="#__codelineno-10-109">109</a></span>
<span class="normal"><a href="#__codelineno-10-110">110</a></span>
<span class="normal"><a href="#__codelineno-10-111">111</a></span>
<span class="normal"><a href="#__codelineno-10-112">112</a></span>
<span class="normal"><a href="#__codelineno-10-113">113</a></span>
<span class="normal"><a href="#__codelineno-10-114">114</a></span>
<span class="normal"><a href="#__codelineno-10-115">115</a></span>
<span class="normal"><a href="#__codelineno-10-116">116</a></span>
<span class="normal"><a href="#__codelineno-10-117">117</a></span>
<span class="normal"><a href="#__codelineno-10-118">118</a></span>
<span class="normal"><a href="#__codelineno-10-119">119</a></span>
<span class="normal"><a href="#__codelineno-10-120">120</a></span>
<span class="normal"><a href="#__codelineno-10-121">121</a></span>
<span class="normal"><a href="#__codelineno-10-122">122</a></span>
<span class="normal"><a href="#__codelineno-10-123">123</a></span>
<span class="normal"><a href="#__codelineno-10-124">124</a></span>
<span class="normal"><a href="#__codelineno-10-125">125</a></span>
<span class="normal"><a href="#__codelineno-10-126">126</a></span>
<span class="normal"><a href="#__codelineno-10-127">127</a></span>
<span class="normal"><a href="#__codelineno-10-128">128</a></span>
<span class="normal"><a href="#__codelineno-10-129">129</a></span>
<span class="normal"><a href="#__codelineno-10-130">130</a></span>
<span class="normal"><a href="#__codelineno-10-131">131</a></span>
<span class="normal"><a href="#__codelineno-10-132">132</a></span>
<span class="normal"><a href="#__codelineno-10-133">133</a></span>
<span class="normal"><a href="#__codelineno-10-134">134</a></span>
<span class="normal"><a href="#__codelineno-10-135">135</a></span>
<span class="normal"><a href="#__codelineno-10-136">136</a></span>
<span class="normal"><a href="#__codelineno-10-137">137</a></span>
<span class="normal"><a href="#__codelineno-10-138">138</a></span>
<span class="normal"><a href="#__codelineno-10-139">139</a></span>
<span class="normal"><a href="#__codelineno-10-140">140</a></span>
<span class="normal"><a href="#__codelineno-10-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">import</span> <span class="nn">unittest</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="k">def</span> <span class="nf">masking_values</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">pixel_val</span><span class="p">):</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a boolean mask related to invalid</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="sd">    pixels in an array. True belongs to valid</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="sd">    pixels, where &#39;pixel_value&#39; is not found&quot;&quot;&quot;</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">!=</span> <span class="n">pixel_val</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="k">return</span> <span class="n">mask</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="k">def</span> <span class="nf">change_dtype_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Changes the data type of an array&quot;&quot;&quot;</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a>    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="k">def</span> <span class="nf">return_index_2D_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the index for valid data in an array,</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="sd">    as a list of tuples, with each tuple containing the</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="sd">    coordinates of valid data in the image for each pixel&quot;&quot;&quot;</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a>    <span class="n">listOfCoordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a>    <span class="k">return</span> <span class="n">listOfCoordinates</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="k">def</span> <span class="nf">return_image_coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">gt</span><span class="p">):</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="sd">    From pixel coordinates (x,y), returns</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="sd">    the image coordinates. It requires the</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="sd">    Geotransform parameters as a list (gt).</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a>    <span class="n">xoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a>    <span class="n">px_w</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a>    <span class="n">rot1</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a>    <span class="n">yoffset</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a>    <span class="n">rot2</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a>    <span class="n">px_h</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a>    <span class="n">xgeo</span> <span class="o">=</span> <span class="n">px_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rot1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">xoffset</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48"></a>    <span class="n">ygeo</span> <span class="o">=</span> <span class="n">rot2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">px_h</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yoffset</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49"></a>    <span class="n">xgeo</span> <span class="o">+=</span> <span class="n">px_w</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50"></a>    <span class="n">ygeo</span> <span class="o">+=</span> <span class="n">px_h</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51"></a>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52"></a>    <span class="k">return</span> <span class="n">xgeo</span><span class="p">,</span> <span class="n">ygeo</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53"></a>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54"></a>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="k">class</span> <span class="nc">TestPixelStats</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56"></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The setup files to run these tests are</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="sd">        located in the output folder and are created</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59"></a><span class="sd">        with the create_test_files.py script&quot;&quot;&quot;</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_path</span> <span class="o">=</span> <span class="s2">&quot;output/value_raster.tif&quot;</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span> <span class="o">=</span> <span class="s2">&quot;output/mask_raster.tif&quot;</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62"></a>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values_path</span><span class="p">)</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_path</span><span class="p">)</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65"></a>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_ds_mask</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68"></a>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69"></a>    <span class="k">def</span> <span class="nf">test_masking_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if after creating a boolean mask</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="sd">        with True values returned where valid data</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="sd">        are located, and False whenever the invalid</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="sd">        value is found in the array. In this case,</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="sd">        we take 0 as the invalid value&quot;&quot;&quot;</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79"></a>            <span class="p">[</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82"></a>                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83"></a>                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84"></a>                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85"></a>            <span class="p">]</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86"></a>        <span class="p">)</span>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87"></a>        <span class="n">should_be</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">should_be</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">should_be</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89"></a>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90"></a>    <span class="k">def</span> <span class="nf">testing_return_index_2D_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates in the image are returned</span>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92"></a><span class="sd">        from a value array. Valid pixels are the ones different</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93"></a><span class="sd">        from 0&quot;&quot;&quot;</span>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109"></a>        <span class="p">]</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index_valid_data</span><span class="p">,</span> <span class="n">list_of_coordinates</span><span class="p">)</span>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111"></a>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112"></a>    <span class="k">def</span> <span class="nf">testing_return_pos_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates for a pixel position</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114"></a><span class="sd">        on an image are returned for valid data. In this case,</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115"></a><span class="sd">        no valid data is 0&quot;&quot;&quot;</span>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119"></a>        <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120"></a>        <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126"></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130"></a>            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131"></a>        <span class="p">]</span>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132"></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133"></a>        <span class="n">test_posx</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134"></a>        <span class="n">test_posy</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135"></a>        <span class="n">geo_posx</span><span class="p">,</span> <span class="n">geo_posy</span> <span class="o">=</span> <span class="n">return_image_coordinate</span><span class="p">(</span><span class="n">test_posx</span><span class="p">,</span> <span class="n">test_posy</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span>
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posx</span><span class="p">,</span> <span class="mi">300005</span><span class="p">)</span>
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">geo_posy</span><span class="p">,</span> <span class="mi">1000015</span><span class="p">)</span>
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138"></a>
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139"></a>
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>In this re-written version of the test suite by Chat-GPT, the masking_values and change_dtype_array functions are declared outside the TestPixelStats class and are utilized directly within the test methods.</p>
<h2 id="what-if-pytest">What if pytest?</h2>
<p>My second improvement in the test suite is to change the unittest framework for the pytest framework. I will ask Chat-GPT to translate the unittest to a pytest, use fixtures to replace the setUp method, and finally do some more improvements like creating better docstrings for the functions, and giving better formatted docstrings. The reason behind changing to pytest is personal. Even though unittest is part of the standard library, I find pytest less boiler plate.</p>
<p align="center">
      <img src="./../chat_gpt_5_question.png" alt="Centered Image">
      <br>
</p>

<details>
<summary>Code</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">  1</a></span>
<span class="normal"><a href="#__codelineno-11-2">  2</a></span>
<span class="normal"><a href="#__codelineno-11-3">  3</a></span>
<span class="normal"><a href="#__codelineno-11-4">  4</a></span>
<span class="normal"><a href="#__codelineno-11-5">  5</a></span>
<span class="normal"><a href="#__codelineno-11-6">  6</a></span>
<span class="normal"><a href="#__codelineno-11-7">  7</a></span>
<span class="normal"><a href="#__codelineno-11-8">  8</a></span>
<span class="normal"><a href="#__codelineno-11-9">  9</a></span>
<span class="normal"><a href="#__codelineno-11-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-11-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-11-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-11-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-11-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-11-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-11-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-11-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-11-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-11-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-11-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-11-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-11-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-11-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-11-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-11-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-11-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-11-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-11-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-11-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-11-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-11-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-11-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-11-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-11-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-11-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-11-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-11-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-11-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-11-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-11-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-11-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-11-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-11-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-11-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-11-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-11-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-11-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-11-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-11-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-11-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-11-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-11-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-11-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-11-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-11-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-11-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-11-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-11-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-11-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-11-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-11-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-11-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-11-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-11-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-11-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-11-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-11-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-11-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-11-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-11-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-11-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-11-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-11-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-11-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-11-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-11-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-11-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-11-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-11-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-11-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-11-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-11-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-11-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-11-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-11-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-11-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-11-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-11-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-11-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-11-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-11-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-11-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-11-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-11-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-11-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-11-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-11-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-11-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-11-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-11-100">100</a></span>
<span class="normal"><a href="#__codelineno-11-101">101</a></span>
<span class="normal"><a href="#__codelineno-11-102">102</a></span>
<span class="normal"><a href="#__codelineno-11-103">103</a></span>
<span class="normal"><a href="#__codelineno-11-104">104</a></span>
<span class="normal"><a href="#__codelineno-11-105">105</a></span>
<span class="normal"><a href="#__codelineno-11-106">106</a></span>
<span class="normal"><a href="#__codelineno-11-107">107</a></span>
<span class="normal"><a href="#__codelineno-11-108">108</a></span>
<span class="normal"><a href="#__codelineno-11-109">109</a></span>
<span class="normal"><a href="#__codelineno-11-110">110</a></span>
<span class="normal"><a href="#__codelineno-11-111">111</a></span>
<span class="normal"><a href="#__codelineno-11-112">112</a></span>
<span class="normal"><a href="#__codelineno-11-113">113</a></span>
<span class="normal"><a href="#__codelineno-11-114">114</a></span>
<span class="normal"><a href="#__codelineno-11-115">115</a></span>
<span class="normal"><a href="#__codelineno-11-116">116</a></span>
<span class="normal"><a href="#__codelineno-11-117">117</a></span>
<span class="normal"><a href="#__codelineno-11-118">118</a></span>
<span class="normal"><a href="#__codelineno-11-119">119</a></span>
<span class="normal"><a href="#__codelineno-11-120">120</a></span>
<span class="normal"><a href="#__codelineno-11-121">121</a></span>
<span class="normal"><a href="#__codelineno-11-122">122</a></span>
<span class="normal"><a href="#__codelineno-11-123">123</a></span>
<span class="normal"><a href="#__codelineno-11-124">124</a></span>
<span class="normal"><a href="#__codelineno-11-125">125</a></span>
<span class="normal"><a href="#__codelineno-11-126">126</a></span>
<span class="normal"><a href="#__codelineno-11-127">127</a></span>
<span class="normal"><a href="#__codelineno-11-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">import</span> <span class="nn">pytest</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="k">def</span> <span class="nf">masking_values</span><span class="p">(</span><span class="n">arr1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pixel_val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="sd">    Creates a boolean mask related to invalid pixels in an array.</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="sd">    True belongs to valid pixels, where &#39;pixel_value&#39; is not found.</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">!=</span> <span class="n">pixel_val</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a>    <span class="k">return</span> <span class="n">mask</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="k">def</span> <span class="nf">change_dtype_array</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Changes the data type of an array.&quot;&quot;&quot;</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a>    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="k">def</span> <span class="nf">return_index_2D_array</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="sd">    Returns the index for valid data in the array as a list of tuples.</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="sd">    Each tuple contains the coordinates of valid data in the image for each pixel.</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a>    <span class="n">listOfCoordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a>    <span class="k">return</span> <span class="n">listOfCoordinates</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="k">def</span> <span class="nf">return_image_coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="sd">    From pixel coordinates (x,y), returns the image coordinates.</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="sd">    It requires the Geotransform parameters as a list (gt).</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a>    <span class="n">xoffset</span><span class="p">,</span> <span class="n">px_w</span><span class="p">,</span> <span class="n">rot1</span><span class="p">,</span> <span class="n">yoffset</span><span class="p">,</span> <span class="n">rot2</span><span class="p">,</span> <span class="n">px_h</span> <span class="o">=</span> <span class="n">gt</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a>    <span class="n">xgeo</span> <span class="o">=</span> <span class="n">px_w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rot1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">xoffset</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41"></a>    <span class="n">ygeo</span> <span class="o">=</span> <span class="n">rot2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">px_h</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yoffset</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42"></a>    <span class="n">xgeo</span> <span class="o">+=</span> <span class="n">px_w</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43"></a>    <span class="n">ygeo</span> <span class="o">+=</span> <span class="n">px_h</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44"></a>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45"></a>    <span class="k">return</span> <span class="n">xgeo</span><span class="p">,</span> <span class="n">ygeo</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46"></a>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47"></a>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="k">def</span> <span class="nf">test_data</span><span class="p">():</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50"></a>    <span class="n">values_path</span> <span class="o">=</span> <span class="s2">&quot;output/value_raster.tif&quot;</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51"></a>    <span class="n">mask_path</span> <span class="o">=</span> <span class="s2">&quot;output/mask_raster.tif&quot;</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52"></a>    <span class="n">in_ds_values</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">values_path</span><span class="p">)</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53"></a>    <span class="n">in_ds_mask</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">mask_path</span><span class="p">)</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54"></a>    <span class="n">values_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">in_ds_values</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55"></a>    <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">in_ds_mask</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56"></a>    <span class="k">return</span> <span class="n">values_arr</span><span class="p">,</span> <span class="n">mask_arr</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57"></a>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58"></a>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59"></a><span class="k">def</span> <span class="nf">test_masking_values</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests if after creating a boolean mask with True values returned where valid data</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61"></a><span class="sd">    are located, and False whenever the invalid value is found in the array. In this case,</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62"></a><span class="sd">    we take 0 as the invalid value.&quot;&quot;&quot;</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63"></a>    <span class="n">values_arr</span><span class="p">,</span> <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">test_data</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67"></a>    <span class="n">should_be</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68"></a>        <span class="p">[</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69"></a>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70"></a>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71"></a>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72"></a>            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73"></a>            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74"></a>        <span class="p">]</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75"></a>    <span class="p">)</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76"></a>    <span class="n">should_be</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">should_be</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77"></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">should_be</span><span class="p">)</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78"></a>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79"></a>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80"></a><span class="k">def</span> <span class="nf">test_return_index_2D_array</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates in the image are returned from a value array.</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82"></a><span class="sd">    Valid pixels are the ones different from 0.&quot;&quot;&quot;</span>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83"></a>    <span class="n">values_arr</span><span class="p">,</span> <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">test_data</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87"></a>    <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88"></a>    <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89"></a>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90"></a>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99"></a>    <span class="p">]</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100"></a>    <span class="k">assert</span> <span class="n">index_valid_data</span> <span class="o">==</span> <span class="n">list_of_coordinates</span>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101"></a>
</span><span id="__span-11-102"><a id="__codelineno-11-102" name="__codelineno-11-102"></a>
</span><span id="__span-11-103"><a id="__codelineno-11-103" name="__codelineno-11-103"></a><span class="k">def</span> <span class="nf">test_return_image_coordinate</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="__span-11-104"><a id="__codelineno-11-104" name="__codelineno-11-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests if position coordinates for a pixel position on an image are returned</span>
</span><span id="__span-11-105"><a id="__codelineno-11-105" name="__codelineno-11-105"></a><span class="sd">    for valid data. In this case, no valid data is 0.&quot;&quot;&quot;</span>
</span><span id="__span-11-106"><a id="__codelineno-11-106" name="__codelineno-11-106"></a>    <span class="n">values_arr</span><span class="p">,</span> <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">test_data</span>
</span><span id="__span-11-107"><a id="__codelineno-11-107" name="__codelineno-11-107"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">masking_values</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-108"><a id="__codelineno-11-108" name="__codelineno-11-108"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">values_arr</span><span class="p">)</span>
</span><span id="__span-11-109"><a id="__codelineno-11-109" name="__codelineno-11-109"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">change_dtype_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="__span-11-110"><a id="__codelineno-11-110" name="__codelineno-11-110"></a>    <span class="n">index_valid_data</span> <span class="o">=</span> <span class="n">return_index_2D_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-111"><a id="__codelineno-11-111" name="__codelineno-11-111"></a>    <span class="n">list_of_coordinates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-112"><a id="__codelineno-11-112" name="__codelineno-11-112"></a>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-113"><a id="__codelineno-11-113" name="__codelineno-11-113"></a>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-114"><a id="__codelineno-11-114" name="__codelineno-11-114"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-115"><a id="__codelineno-11-115" name="__codelineno-11-115"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-116"><a id="__codelineno-11-116" name="__codelineno-11-116"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-11-117"><a id="__codelineno-11-117" name="__codelineno-11-117"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-11-118"><a id="__codelineno-11-118" name="__codelineno-11-118"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="__span-11-119"><a id="__codelineno-11-119" name="__codelineno-11-119"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-120"><a id="__codelineno-11-120" name="__codelineno-11-120"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-11-121"><a id="__codelineno-11-121" name="__codelineno-11-121"></a>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="__span-11-122"><a id="__codelineno-11-122" name="__codelineno-11-122"></a>    <span class="p">]</span>
</span><span id="__span-11-123"><a id="__codelineno-11-123" name="__codelineno-11-123"></a>    <span class="n">gt</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;output/value_raster.tif&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</span><span id="__span-11-124"><a id="__codelineno-11-124" name="__codelineno-11-124"></a>    <span class="n">test_posx</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-11-125"><a id="__codelineno-11-125" name="__codelineno-11-125"></a>    <span class="n">test_posy</span> <span class="o">=</span> <span class="n">list_of_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-11-126"><a id="__codelineno-11-126" name="__codelineno-11-126"></a>    <span class="n">geo_posx</span><span class="p">,</span> <span class="n">geo_posy</span> <span class="o">=</span> <span class="n">return_image_coordinate</span><span class="p">(</span><span class="n">test_posx</span><span class="p">,</span> <span class="n">test_posy</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span>
</span><span id="__span-11-127"><a id="__codelineno-11-127" name="__codelineno-11-127"></a>    <span class="k">assert</span> <span class="n">geo_posx</span> <span class="o">==</span> <span class="mi">300005</span>
</span><span id="__span-11-128"><a id="__codelineno-11-128" name="__codelineno-11-128"></a>    <span class="k">assert</span> <span class="n">geo_posy</span> <span class="o">==</span> <span class="mi">1000015</span>
</span></code></pre></div></td></tr></table></div>
</details>

<p>I ran the tests and the feedback is still positive.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>$ python -m pytest
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>=============================================================== test session starts ================================================================
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>platform win32 -- Python 3.10.4, pytest-7.2.0, pluggy-1.0.0
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>rootdir: C:\Users\almrog\pixel_stats
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>plugins: anyio-3.6.2
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>collected 3 items
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>test_pixel_stats.py ...                                                                                                                       [100%]
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>================================================================ 3 passed in 0.32s =================================================================
</span></code></pre></div>
</div>
<p>In this version, the code uses the pytest framework and fixtures to replace the setUp method. The functions masking_values, change_dtype_array, return_index_2D_array, and return_image_coordinate are declared outside the test class and are utilized directly within the test functions. The code includes type hints and improved docstrings for better readability and clarity.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Chat-GPT (or advanced language processing systems) can indeed be intimidating for software developers. These systems not only provide code solutions but also offer explanations and improvements, almost automatically. However, just like any tool that facilitates work for professionals (such as chainsaws for forestry workers or cranes for construction workers), language processing systems that can translate ideas into code are useful if you have a solid understanding of your work, you know relevant concepts, and know what results you expect. In other words, you could eventually arrive at the same solution on your own, but it would undoubtedly take more time. At present, I am thrilled about these advancements that make our lives as programmers easier and allow us to focus on software design and delivering solutions to our clients.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.select"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4e31edb1.min.js"></script>
      
        
          <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
        
      
        
          <script src="../../../javascripts/highlight.js"></script>
        
      
    
  </body>
</html>